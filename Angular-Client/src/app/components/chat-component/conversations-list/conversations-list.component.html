<div class="conversations-container">
    <div class="conversations-header">
        <h3 class="header-title">
            <span class="chat-icon">ðŸ’¬</span>
            Chats
        </h3>
        <button class="create-group-btn" (click)="onCreateGroupClick()" aria-label="Create group">
            <svg viewBox="0 0 24 24" width="18" height="18">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
            </svg>
        </button>
    </div>

    <div class="conversations-list">
        <div class="empty-state" *ngIf="combinedList.length === 0">
            <div class="empty-icon">ðŸ“­</div>
            <p class="empty-message">No chats yet</p>
            <p class="empty-subtitle">Start a chat or create a group</p>
        </div>

        <div class="conversation-item" *ngFor="let item of combinedList; trackBy: trackByItemId; let i = index"
            (click)="onItemClick(item)">

            <div class="conversation-avatar">
                <div class="avatar-container" [class.group-avatar]="isConversation(item) && item.type === 'group'"
                    [class.user-avatar]="isUser(item)">
                    {{ getItemInitials(item) }}

                    <!-- Online indicator for users -->
                    <div class="online-indicator" *ngIf="isUser(item) && item.isOnline"></div>

                    <!-- Online indicator for one-to-one conversations -->
                    <div class="online-indicator"
                        *ngIf="isConversation(item) && item.type === 'one-to-one' && isConversationOnline(item)"></div>

                    <!-- Group indicator -->
                    <div class="group-indicator" *ngIf="isConversation(item) && item.type === 'group'">
                        <svg viewBox="0 0 24 24" width="12" height="12">
                            <path
                                d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zM4 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm5 7c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2z" />
                        </svg>
                    </div>
                </div>
            </div>

            <div class="conversation-info">
                <div class="conversation-header-row">
                    <div class="conversation-name">{{ getItemName(item) }}</div>
                    <div class="conversation-time" *ngIf="isConversation(item) && item.lastMessage">
                        {{ getLastMessageTime(item) }}
                    </div>
                </div>

                <div class="conversation-details">
                    <!-- Group conversation details -->
                    <div class="last-message"
                        *ngIf="isConversation(item) && item.type === 'group' && item.lastMessage; else groupNoMessage">
                        <span class="message-preview">
                            <span class="sender-name">{{ getSenderName(item.lastMessage.senderId) }}:</span>
                            {{ item.lastMessage.content }}
                        </span>
                    </div>

                    <!-- One-to-one conversation details -->
                    <div class="last-message"
                        *ngIf="isConversation(item) && item.type === 'one-to-one' && item.lastMessage; else oneToOneNoMessage">
                        <span class="message-preview">
                            {{ item.lastMessage.content }}
                        </span>
                    </div>

                    <!-- User item (no conversation yet) -->
                    <div class="no-message" *ngIf="isUser(item)">
                        <span class="no-message-text">
                            Click to start chatting
                        </span>
                    </div>

                    <!-- No message templates -->
                    <ng-template #groupNoMessage>
                        <div class="no-message" *ngIf="isConversation(item) && item.type === 'group'">
                            <span class="group-members-preview">
                                {{ getGroupMembersPreview(item) }}
                            </span>
                        </div>
                    </ng-template>

                    <ng-template #oneToOneNoMessage>
                        <div class="no-message" *ngIf="isConversation(item) && item.type === 'one-to-one'">
                            <span class="no-message-text">No messages yet</span>
                        </div>
                    </ng-template>

                    <div class="conversation-badges">
                        <!-- Group member count -->
                        <div class="group-badge" *ngIf="isConversation(item) && item.type === 'group'">
                            <svg viewBox="0 0 24 24" width="12" height="12">
                                <path
                                    d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zM4 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm5 7c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2z" />
                            </svg>
                            {{ item.participants.length }} members
                        </div>

                        <!-- Unread messages for conversations -->
                        <div class="unread-badge"
                            *ngIf="isConversation(item) && item.unreadCount && item.unreadCount > 0">
                            {{ item.unreadCount > 99 ? '99+' : item.unreadCount }}
                        </div>

                        <!-- New message indicator for users -->
                        <div class="new-user-badge" *ngIf="isUser(item)">
                            <svg viewBox="0 0 24 24" width="12" height="12">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <div class="conversation-chevron">
                <svg viewBox="0 0 24 24" width="16" height="16">
                    <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                </svg>
            </div>
        </div>
    </div>

    <!-- Floating Action Button for Creating Groups -->
    <div class="fab-container">
        <button class="fab" (click)="onCreateGroupClick()" title="Create Group">
            <svg viewBox="0 0 24 24" width="24" height="24">
                <path
                    d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zM4 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm5 7c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2z" />
                <circle cx="12" cy="19" r="2" />
            </svg>
        </button>
    </div>
</div>