<div class="chat-container">
    <div class="app-header">
        <h1 class="app-title">
            <span class="chat-icon">ðŸ’¬</span>
            Global Chat
        </h1>
        <div class="header-controls">
            <div class="user-info">
                <div class="user-avatar-small">{{ getInitials(userName) }}</div>
                <span class="user-welcome">{{ userName }}</span>
            </div>
        </div>
    </div>

    <div class="chat-content" [ngSwitch]="currentPage">
        <!-- Unified Chat List View (Groups + One-to-One) -->
        <div *ngSwitchCase="chatPages.LIST" class="list-view">
            <app-conversations-list [currentUserId]="userId" [currentUserName]="userName"
                (conversationSelected)="onConversationSelected($event)" (userSelected)="onUserSelected($event)"
                (createGroupClick)="onCreateGroupRequested()">
            </app-conversations-list>
        </div>

        <!-- Chat Box View -->
        <div *ngSwitchCase="chatPages.CHAT" class="chat-view">
            <app-chat-box [selectedUser]="selectedUser" [selectedConversation]="selectedConversation"
                [currentUserId]="userId" (backToList)="onBackToList()">
            </app-chat-box>
        </div>
    </div>

    <!-- Group Creation Modal -->
    <div class="group-creation-modal" *ngIf="isCreatingGroup" (click)="onModalBackdropClick($event)">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>Create New Group</h2>
                <button class="close-btn" (click)="cancelGroupCreation()">&times;</button>
            </div>

            <div class="modal-body">
                <div class="form-group">
                    <label for="groupName">Group Name *</label>
                    <input type="text" id="groupName" [(ngModel)]="groupCreationData.name"
                        placeholder="Enter group name" maxlength="50" class="form-input">
                    <small class="char-count">{{ groupCreationData.name.length }}/50</small>
                </div>

                <div class="form-group">
                    <label for="groupDescription">Description (Optional)</label>
                    <textarea id="groupDescription" [(ngModel)]="groupCreationData.description"
                        placeholder="Enter group description" maxlength="200" class="form-textarea" rows="3"></textarea>
                    <small class="char-count">{{ (groupCreationData.description || '').length }}/200</small>
                </div>

                <div class="form-group">
                    <label>Add Members</label>
                    <div class="users-list">
                        <div *ngFor="let user of getAvailableUsers()" class="user-item"
                            [class.selected]="isUserSelected(user.userId)" (click)="toggleUserSelection(user.userId)">

                            <div class="user-avatar">{{ getInitials(user.username) }}</div>
                            <div class="user-info">
                                <span class="username">{{ user.username }}</span>
                                <span class="status" *ngIf="user.isOnline">Online</span>
                            </div>
                            <div class="selection-indicator">
                                <svg *ngIf="isUserSelected(user.userId)" viewBox="0 0 24 24" width="20" height="20">
                                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                                </svg>
                            </div>
                        </div>

                        <div *ngIf="getAvailableUsers().length === 0" class="no-users">
                            <p>No online users available to add to the group.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" (click)="cancelGroupCreation()">Cancel</button>
                <button class="btn btn-primary" (click)="createGroup()"
                    [disabled]="!canCreateGroup() || isCreatingGroupLoading" [class.loading]="isCreatingGroupLoading">
                    {{ isCreatingGroupLoading ? 'Creating...' : 'Create Group' }}
                </button>
            </div>
        </div>
    </div>
</div>